<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAvatarChat - æ•°å­—äººäº¤äº’æŠ€æœ¯æ¶æ„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", Arial, sans-serif;
            line-height: 1.8;
            color: #2c3e50;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: pulse 15s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 60px 40px;
        }

        .section {
            margin-bottom: 60px;
        }

        .section-title {
            font-size: 2.2em;
            color: #43e97b;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #43e97b;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 8px;
            height: 40px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            margin-right: 15px;
            border-radius: 4px;
        }

        .subsection-title {
            font-size: 1.6em;
            color: #38f9d7;
            margin: 30px 0 20px 0;
            display: flex;
            align-items: center;
        }

        .subsection-title::before {
            content: 'â–¶';
            margin-right: 10px;
            color: #43e97b;
        }

        .tech-overview {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tech-overview h3 {
            color: #43e97b;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .architecture-diagram {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .diagram-box {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 10px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);
            transition: transform 0.3s ease;
        }

        .diagram-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.5);
        }

        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 25px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 0.95em;
            line-height: 1.6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .code-block::before {
            content: attr(data-lang);
            position: absolute;
            top: 10px;
            right: 15px;
            background: #43e97b;
            color: white;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.8em;
        }

        .code-keyword {
            color: #c678dd;
        }

        .code-string {
            color: #98c379;
        }

        .code-comment {
            color: #5c6370;
            font-style: italic;
        }

        .code-function {
            color: #61afef;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(67, 233, 123, 0.5);
        }

        .feature-card h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .feature-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .flow-diagram {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .flow-step {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 25px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #43e97b;
            transition: transform 0.3s ease;
            position: relative;
            margin-left: 50px;
        }

        .flow-step:hover {
            transform: translateX(10px);
        }

        .flow-step::before {
            content: attr(data-step);
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(67, 233, 123, 0.5);
        }

        .flow-step h4 {
            color: #43e97b;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .tech-item {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #43e97b;
            transition: transform 0.3s ease;
        }

        .tech-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .tech-item h4 {
            color: #43e97b;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border-left: 5px solid #fdcb6e;
            box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);
        }

        .highlight-box strong {
            color: #d63031;
            font-size: 1.1em;
        }

        .data-flow-diagram {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }

        .flow-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .flow-box {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin: 10px;
            min-width: 150px;
            border: 3px solid #43e97b;
        }

        .flow-box h4 {
            color: #43e97b;
            margin-bottom: 10px;
        }

        .arrow-right {
            font-size: 2.5em;
            color: #43e97b;
            margin: 0 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .comparison-table thead {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 18px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table tbody tr:hover {
            background: #f5f7fa;
        }

        .info-badge {
            display: inline-block;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin: 5px;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 40px;
            text-align: center;
        }

        .footer p {
            margin: 10px 0;
        }

        pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .layer-diagram {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }

        .layer {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 6px solid #43e97b;
        }

        .layer h3 {
            color: #43e97b;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .header .subtitle {
                font-size: 1em;
            }

            .content {
                padding: 30px 20px;
            }

            .section-title {
                font-size: 1.6em;
            }

            .feature-grid,
            .tech-stack {
                grid-template-columns: 1fr;
            }

            .flow-step {
                margin-left: 0;
                padding-left: 50px;
            }

            .flow-step::before {
                left: 10px;
            }

            .arrow-right {
                display: block;
                transform: rotate(90deg);
                margin: 20px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ­ æ•°å­—äººäº¤äº’æŠ€æœ¯æ¶æ„</h1>
            <p class="subtitle">WebRTC + å¤šæ¨¡æ€AI + å±å¹•å…±äº« å®ç°å®æ—¶è§†è§‰å¯¹è¯</p>
            <p style="margin-top: 20px; font-size: 1.1em;">
                <strong>é¡¹ç›®ï¼š</strong>OpenAvatarChat &nbsp;|&nbsp; 
                <strong>å¼€å‘è€…ï¼š</strong>å»–ä¼Ÿæ° &nbsp;|&nbsp; 
                <strong>æ›´æ–°æ—¶é—´ï¼š</strong>2025-11-11
            </p>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- æ¦‚è¿° -->
            <div class="section">
                <h2 class="section-title">ğŸ“‹ æŠ€æœ¯æ¦‚è¿°</h2>
                <div class="tech-overview">
                    <h3>ğŸ¯ æ ¸å¿ƒåˆ›æ–°</h3>
                    <p>
                        OpenAvatarChatæ•°å­—äººäº¤äº’ç³»ç»Ÿé€šè¿‡<strong>WebRTCå®æ—¶é€šä¿¡</strong>å®ç°"çœ‹å¾—è§ã€å¬å¾—åˆ°ã€èƒ½ç†è§£"çš„æ™ºèƒ½å¯¹è¯ã€‚
                        ç”¨æˆ·çš„<strong>æ‘„åƒå¤´ç”»é¢</strong>å®æ—¶ä¼ è¾“ç»™å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹ï¼ˆVL-LLMï¼‰ï¼ŒAIèƒ½"çœ‹åˆ°"ç”¨æˆ·çš„è¡¨æƒ…ã€æ‰‹åŠ¿ã€ç‰©å“ï¼Œ
                        ç†è§£è§†è§‰ä¿¡æ¯å¹¶ç»™å‡ºæ™ºèƒ½å“åº”ã€‚<strong>å±å¹•å…±äº«åŠŸèƒ½</strong>è¿›ä¸€æ­¥æ‰©å±•äº†AIçš„"è§†é‡"ï¼Œè®©AIèƒ½çœ‹åˆ°ç”¨æˆ·çš„ç”µè„‘å±å¹•å†…å®¹ï¼Œ
                        å®ç°æ›´é«˜çº§çš„äº¤äº’åœºæ™¯ã€‚
                    </p>
                    <p style="margin-top: 15px;">
                        <span class="info-badge">ğŸ“¹ å®æ—¶è§†é¢‘</span>
                        <span class="info-badge">ğŸ¤ è¯­éŸ³å¯¹è¯</span>
                        <span class="info-badge">ğŸ‘ï¸ è§†è§‰ç†è§£</span>
                        <span class="info-badge">ğŸ–¥ï¸ å±å¹•å…±äº«</span>
                        <span class="info-badge">ğŸ­ æ•°å­—äººæ¸²æŸ“</span>
                    </p>
                </div>

                <div class="highlight-box">
                    <strong>ğŸ’¡ æŠ€æœ¯çªç ´ï¼š</strong>
                    æ‘„åƒå¤´è§†é¢‘æµé€šè¿‡<strong>WebRTC</strong>å®æ—¶ä¼ è¾“ â†’ æœåŠ¡ç«¯æå–<strong>è§†é¢‘å¸§</strong> â†’ <strong>Base64ç¼–ç </strong>
                    â†’ å‘é€ç»™<strong>å¤šæ¨¡æ€LLM</strong> â†’ AIç†è§£å›¾åƒå†…å®¹ â†’ ç”Ÿæˆæ™ºèƒ½å›å¤ â†’ <strong>TTSè¯­éŸ³åˆæˆ</strong> â†’ 
                    <strong>æ•°å­—äººè§†é¢‘</strong> â†’ è¿”å›ç»™ç”¨æˆ·ã€‚æ•´ä¸ªè¿‡ç¨‹ç«¯åˆ°ç«¯å»¶è¿Ÿä»…çº¦2.2ç§’ï¼
                </div>
            </div>

            <!-- æ•´ä½“æ¶æ„ -->
            <div class="section">
                <h2 class="section-title">ğŸ—ï¸ æ•´ä½“ç³»ç»Ÿæ¶æ„</h2>
                
                <div class="architecture-diagram">
                    <h3 style="color: #43e97b; margin-bottom: 30px; text-align: center;">ç«¯åˆ°ç«¯äº¤äº’æµç¨‹</h3>
                    
                    <div style="text-align: center;">
                        <pre style="display: inline-block; text-align: left; background: #f5f7fa; padding: 30px; border-radius: 10px; color: #2c3e50; font-size: 0.95em; line-height: 2;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·ä¾§ï¼ˆæµè§ˆå™¨ï¼‰                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“· æ‘„åƒå¤´ â”€â”€â”                                                       â”‚
â”‚  ğŸ¤ éº¦å…‹é£ â”€â”€â”¼â”€â–º ğŸŒ WebRTC â”€â”€â–º ğŸ“¡ ä¿¡ä»¤æœåŠ¡å™¨                        â”‚
â”‚  ğŸ–¥ï¸ å±å¹• â”€â”€â”€â”€â”˜      (åª’ä½“æµ)      (Offer/Answer)                   â”‚
â”‚                                                                      â”‚
â”‚  â—„â”€â”€ ğŸ­ æ•°å­—äººè§†é¢‘ + ğŸ”Š AIè¯­éŸ³ â—„â”€â”€ WebRTCè¿”å›                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœåŠ¡ç«¯ï¼ˆPython/FastAPIï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¡ RTC Client Handler                                              â”‚
â”‚    â”œâ”€ æ¥æ”¶WebRTCåª’ä½“æµ                                              â”‚
â”‚    â”œâ”€ æå–è§†é¢‘å¸§ï¼ˆ30fpsï¼‰ + éŸ³é¢‘æ•°æ®ï¼ˆ16kHz PCMï¼‰                   â”‚
â”‚    â””â”€ æ•°æ®è·¯ç”±åˆ°Handleræµæ°´çº¿                                        â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”„ Handleræµæ°´çº¿ï¼ˆæ¨¡å—åŒ–å¤„ç†ï¼‰                                      â”‚
â”‚    â”œâ”€ ğŸ‘‚ VAD Handlerï¼šæ£€æµ‹è¯­éŸ³èµ·æ­¢                                  â”‚
â”‚    â”œâ”€ ğŸ§ ASR Handlerï¼šè¯­éŸ³è¯†åˆ«ï¼ˆSpeech â†’ Textï¼‰                     â”‚
â”‚    â”œâ”€ ğŸ“¹ Video Handlerï¼šè§†é¢‘å¸§å­˜å‚¨ï¼ˆæœ€æ–°å¸§ç¼“å­˜ï¼‰                     â”‚
â”‚    â”œâ”€ ğŸ§  LLM Handlerï¼šå¤šæ¨¡æ€ç†è§£ï¼ˆText + Image â†’ AI Responseï¼‰      â”‚
â”‚    â”œâ”€ ğŸ”Š TTS Handlerï¼šè¯­éŸ³åˆæˆï¼ˆText â†’ Audioï¼‰                      â”‚
â”‚    â””â”€ ğŸ­ Avatar Handlerï¼šæ•°å­—äººæ¸²æŸ“ï¼ˆAudio â†’ Video + Audioï¼‰        â”‚
â”‚                                                                      â”‚
â”‚  ğŸ“¤ è¾“å‡ºåˆæˆ                                                         â”‚
â”‚    â””â”€ æ•°å­—äººè§†é¢‘ + AIè¯­éŸ³ â†’ WebRTCè¿”å›ç”¨æˆ·                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AIæ¨¡å‹å±‚ï¼ˆæ¨ç†å¼•æ“ï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§ SenseVoiceï¼šè¯­éŸ³è¯†åˆ«ï¼ˆé˜¿é‡Œè¾¾æ‘©é™¢ï¼‰                               â”‚
â”‚  ğŸ§  Qwen-VL-Plusï¼šè§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆå¤šæ¨¡æ€ç†è§£ï¼‰                         â”‚
â”‚  ğŸ”Š CosyVoiceï¼šè¯­éŸ³åˆæˆï¼ˆé«˜è´¨é‡TTSï¼‰                                 â”‚
â”‚  ğŸ­ LiteAvatarï¼š2Dæ•°å­—äººæ¸²æŸ“ï¼ˆéŸ³é¢‘é©±åŠ¨ï¼‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
                    </div>
                </div>

                <div class="layer-diagram">
                    <div class="layer">
                        <h3>ğŸŒ å‰ç«¯å±‚ï¼šVue3 WebRTCå®¢æˆ·ç«¯</h3>
                        <p>
                            <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>æ‘„åƒå¤´/éº¦å…‹é£/å±å¹•æ•è·ã€WebRTCè¿æ¥ç®¡ç†ã€åª’ä½“æµæ§åˆ¶ã€æ•°å­—äººè§†é¢‘æ’­æ”¾<br>
                            <strong>æŠ€æœ¯æ ˆï¼š</strong>Vue 3ã€TypeScriptã€WebRTC APIã€MediaStream APIã€Canvas API<br>
                            <strong>å…³é”®æ–‡ä»¶ï¼š</strong><code>src/handlers/client/rtc_client/frontend/</code>
                        </p>
                    </div>

                    <div class="layer">
                        <h3>ğŸ“¡ é€šä¿¡å±‚ï¼šWebRTC + aiortc</h3>
                        <p>
                            <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>P2Påª’ä½“æµä¼ è¾“ã€TURNä¸­ç»§ç©¿é€ã€ä¿¡ä»¤äº¤æ¢ã€è½¨é“ç®¡ç†<br>
                            <strong>æŠ€æœ¯æ ˆï¼š</strong>aiortcï¼ˆPython WebRTCï¼‰ã€asyncioã€ICEåè®®ã€STUN/TURN<br>
                            <strong>å…³é”®æ–‡ä»¶ï¼š</strong><code>src/handlers/client/rtc_client/client_handler_rtc.py</code>
                        </p>
                    </div>

                    <div class="layer">
                        <h3>âš™ï¸ å¤„ç†å±‚ï¼šHandleræµæ°´çº¿</h3>
                        <p>
                            <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>æ¨¡å—åŒ–æ•°æ®å¤„ç†ã€å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ã€çŠ¶æ€ç®¡ç†ã€é”™è¯¯å¤„ç†<br>
                            <strong>æŠ€æœ¯æ ˆï¼š</strong>Python asyncioã€æ•°æ®é˜Ÿåˆ—ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€æ’ä»¶æ¶æ„<br>
                            <strong>å…³é”®æ–‡ä»¶ï¼š</strong><code>src/chat_engine/</code>ã€<code>src/handlers/</code>
                        </p>
                    </div>

                    <div class="layer">
                        <h3>ğŸ¤– AIå±‚ï¼šå¤šæ¨¡æ€æ¨¡å‹æ¨ç†</h3>
                        <p>
                            <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>è§†è§‰ç†è§£ã€è¯­éŸ³è¯†åˆ«/åˆæˆã€è‡ªç„¶è¯­è¨€å¤„ç†ã€æ•°å­—äººç”Ÿæˆ<br>
                            <strong>æŠ€æœ¯æ ˆï¼š</strong>PyTorchã€Transformersã€OpenAI APIã€é˜¿é‡Œäº‘ç™¾ç‚¼ã€GPUåŠ é€Ÿ<br>
                            <strong>å…³é”®æ¨¡å‹ï¼š</strong>Qwen-VL-Plusã€SenseVoiceã€CosyVoiceã€LiteAvatar
                        </p>
                    </div>
                </div>
            </div>

            <!-- æ‘„åƒå¤´è§†é¢‘å¯¹è¯ -->
            <div class="section">
                <h2 class="section-title">ğŸ“¹ æ‘„åƒå¤´è§†é¢‘å¯¹è¯å®ç°</h2>

                <h3 class="subsection-title">æ ¸å¿ƒé—®é¢˜ï¼šæ‘„åƒå¤´è§†é¢‘å¦‚ä½•ä¼ ç»™å¤§æ¨¡å‹ï¼Ÿ</h3>
                <div class="highlight-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-left-color: #a8edea;">
                    <strong>ç­”æ¡ˆï¼šé€šè¿‡å›¾ç‰‡å¸§ä¼ ç»™å¤§æ¨¡å‹ï¼</strong><br><br>
                    æŠ€æœ¯è·¯çº¿ï¼šæ‘„åƒå¤´ â†’ WebRTC â†’ è§†é¢‘å¸§ï¼ˆNumPyï¼‰ â†’ JPEGå‹ç¼© â†’ Base64ç¼–ç  â†’ æ•°æ®URL â†’ å¤šæ¨¡æ€LLM â†’ AIå“åº”
                </div>

                <h3 class="subsection-title">1. å‰ç«¯ï¼šWebRTCåª’ä½“æµæ•è·</h3>
                <div class="code-block" data-lang="TypeScript">
<pre><span class="code-comment">// å‰ç«¯è·å–æ‘„åƒå¤´å’Œéº¦å…‹é£æµ</span>
<span class="code-keyword">const</span> <span class="code-function">getUserMedia</span> = <span class="code-keyword">async</span> () => {
  <span class="code-keyword">try</span> {
    <span class="code-keyword">const</span> stream = <span class="code-keyword">await</span> navigator.mediaDevices.getUserMedia({
      video: {
        width: { ideal: 640 },      <span class="code-comment">// è§†é¢‘å®½åº¦</span>
        height: { ideal: 480 },     <span class="code-comment">// è§†é¢‘é«˜åº¦</span>
        frameRate: { ideal: 30 }    <span class="code-comment">// å¸§ç‡30fps</span>
      },
      audio: {
        echoCancellation: <span class="code-keyword">true</span>,  <span class="code-comment">// å›å£°æ¶ˆé™¤</span>
        noiseSuppression: <span class="code-keyword">true</span>,  <span class="code-comment">// é™å™ª</span>
        autoGainControl: <span class="code-keyword">true</span>    <span class="code-comment">// è‡ªåŠ¨å¢ç›Š</span>
      }
    });
    
    <span class="code-comment">// æ˜¾ç¤ºæœ¬åœ°è§†é¢‘é¢„è§ˆ</span>
    <span class="code-keyword">const</span> videoElement = document.querySelector(<span class="code-string">'video'</span>);
    videoElement.srcObject = stream;
    
    <span class="code-keyword">return</span> stream;
  } <span class="code-keyword">catch</span> (error) {
    console.error(<span class="code-string">'æ‘„åƒå¤´è®¿é—®å¤±è´¥:'</span>, error);
  }
};

<span class="code-comment">// åˆ›å»ºWebRTCè¿æ¥</span>
<span class="code-keyword">const</span> peerConnection = <span class="code-keyword">new</span> RTCPeerConnection({
  iceServers: [
    { urls: <span class="code-string">"stun:stun.l.google.com:19302"</span> },  <span class="code-comment">// STUNæœåŠ¡å™¨</span>
    { 
      urls: <span class="code-string">"turn:8.138.87.249:3478"</span>,           <span class="code-comment">// TURNæœåŠ¡å™¨</span>
      username: <span class="code-string">"username"</span>,
      credential: <span class="code-string">"password"</span>
    }
  ]
});

<span class="code-comment">// æ·»åŠ åª’ä½“è½¨é“åˆ°PeerConnection</span>
stream.getTracks().forEach(track => {
  peerConnection.addTrack(track, stream);
});</pre>
                </div>

                <h3 class="subsection-title">2. åç«¯ï¼šWebRTCæ¥æ”¶ä¸è§†é¢‘å¸§æå–</h3>
                <div class="code-block" data-lang="Python">
<pre><span class="code-comment"># src/handlers/client/rtc_client/client_handler_rtc.py</span>

<span class="code-keyword">from</span> aiortc <span class="code-keyword">import</span> RTCPeerConnection, MediaStreamTrack
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np

<span class="code-keyword">class</span> <span class="code-function">RtcClientHandler</span>:
    <span class="code-keyword">def</span> <span class="code-function">__init__</span>(self):
        self.peer_connection = RTCPeerConnection()
        self.video_track = <span class="code-keyword">None</span>
        self.audio_track = <span class="code-keyword">None</span>
    
    <span class="code-keyword">async def</span> <span class="code-function">handle_offer</span>(self, offer):
        <span class="code-string">"""å¤„ç†WebRTC Offerï¼Œå»ºç«‹è¿æ¥"""</span>
        <span class="code-keyword">await</span> self.peer_connection.setRemoteDescription(offer)
        
        <span class="code-comment"># ç›‘å¬æ¥æ”¶åˆ°çš„åª’ä½“è½¨é“</span>
        <span class="code-function">@self.peer_connection.on</span>(<span class="code-string">"track"</span>)
        <span class="code-keyword">async def</span> <span class="code-function">on_track</span>(track: MediaStreamTrack):
            <span class="code-keyword">if</span> track.kind == <span class="code-string">"video"</span>:
                self.video_track = track
                asyncio.create_task(self._process_video_frames(track))
            <span class="code-keyword">elif</span> track.kind == <span class="code-string">"audio"</span>:
                self.audio_track = track
                asyncio.create_task(self._process_audio_frames(track))
        
        <span class="code-comment"># åˆ›å»ºAnswer</span>
        answer = <span class="code-keyword">await</span> self.peer_connection.createAnswer()
        <span class="code-keyword">await</span> self.peer_connection.setLocalDescription(answer)
        <span class="code-keyword">return</span> answer
    
    <span class="code-keyword">async def</span> <span class="code-function">_process_video_frames</span>(self, track):
        <span class="code-string">"""å¼‚æ­¥å¤„ç†è§†é¢‘å¸§"""</span>
        <span class="code-keyword">while</span> <span class="code-keyword">True</span>:
            <span class="code-keyword">try</span>:
                <span class="code-comment"># æ¥æ”¶è§†é¢‘å¸§ï¼ˆav.VideoFrameå¯¹è±¡ï¼‰</span>
                frame = <span class="code-keyword">await</span> track.recv()
                
                <span class="code-comment"># è½¬æ¢ä¸ºNumPyæ•°ç»„ï¼ˆRGBæ ¼å¼ï¼‰</span>
                video_array = frame.to_ndarray(format=<span class="code-string">"rgb24"</span>)
                <span class="code-comment"># video_array shape: (height, width, 3)</span>
                
                <span class="code-comment"># æ·»åŠ batchç»´åº¦ (1, height, width, 3)</span>
                video_array = video_array[np.newaxis, ...]
                
                <span class="code-comment"># åˆ›å»ºChatDataå¯¹è±¡å¹¶æäº¤åˆ°å¤„ç†æµæ°´çº¿</span>
                chat_data = ChatData(
                    source=<span class="code-string">"client"</span>,
                    type=ChatDataType.CAMERA_VIDEO,  <span class="code-comment"># æ ‡è®°ä¸ºæ‘„åƒå¤´è§†é¢‘</span>
                    data=DataBundle(video_array),
                    timestamp=time.time()
                )
                
                <span class="code-comment"># æäº¤åˆ°Handleræµæ°´çº¿</span>
                self.data_submitter.submit(chat_data)
                
            <span class="code-keyword">except</span> Exception <span class="code-keyword">as</span> e:
                print(<span class="code-string">f"è§†é¢‘å¸§å¤„ç†é”™è¯¯: {e}"</span>)
                <span class="code-keyword">break</span></pre>
                </div>

                <h3 class="subsection-title">3. å›¾åƒç¼–ç ï¼šNumPy â†’ Base64</h3>
                <div class="code-block" data-lang="Python">
<pre><span class="code-comment"># src/engine_utils/media_utils.py</span>

<span class="code-keyword">import</span> base64
<span class="code-keyword">from</span> io <span class="code-keyword">import</span> BytesIO
<span class="code-keyword">from</span> PIL <span class="code-keyword">import</span> Image
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np

<span class="code-keyword">class</span> <span class="code-function">ImageUtils</span>:
    <span class="code-function">@staticmethod</span>
    <span class="code-keyword">def</span> <span class="code-function">numpy2base64</span>(video_frame: np.ndarray, format=<span class="code-string">"JPEG"</span>) -> str:
        <span class="code-string">"""
        å°†NumPyè§†é¢‘å¸§è½¬æ¢ä¸ºBase64ç¼–ç çš„æ•°æ®URL
        
        Args:
            video_frame: shape (1, H, W, 3) çš„NumPyæ•°ç»„ï¼ˆRGBæ ¼å¼ï¼‰
            format: å›¾åƒæ ¼å¼ï¼ŒJPEGæˆ–PNG
            
        Returns:
            data:image/jpeg;base64,/9j/4AAQ... æ ¼å¼çš„æ•°æ®URL
        """</span>
        
        <span class="code-comment"># 1. å»é™¤batchç»´åº¦ï¼Œshape: (H, W, 3)</span>
        frame = np.squeeze(video_frame)
        
        <span class="code-comment"># 2. RGB â†’ BGR é¢œè‰²é€šé“è½¬æ¢ï¼ˆPILä½¿ç”¨RGBï¼‰</span>
        <span class="code-comment">#    OpenCVä½¿ç”¨BGRï¼Œè¿™é‡Œä»WebRTCè·å–çš„æ˜¯RGBï¼Œæ— éœ€è½¬æ¢</span>
        image = Image.fromarray(frame)
        
        <span class="code-comment"># 3. åˆ›å»ºå†…å­˜ç¼“å†²åŒº</span>
        buffered = BytesIO()
        
        <span class="code-comment"># 4. JPEGå‹ç¼©ä¿å­˜åˆ°å†…å­˜ï¼ˆquality=90å¹³è¡¡è´¨é‡å’Œå¤§å°ï¼‰</span>
        image.save(buffered, format=format, quality=90)
        
        <span class="code-comment"># 5. Base64ç¼–ç </span>
        img_bytes = buffered.getvalue()
        base64_image = base64.b64encode(img_bytes).decode(<span class="code-string">"utf-8"</span>)
        
        <span class="code-comment"># 6. ç”Ÿæˆå®Œæ•´çš„æ•°æ®URL</span>
        data_url = <span class="code-string">f"data:image/{format.lower()};base64,{base64_image}"</span>
        
        <span class="code-keyword">return</span> data_url</pre>
                </div>

                <h3 class="subsection-title">4. å¤šæ¨¡æ€LLMå¤„ç†</h3>
                <div class="code-block" data-lang="Python">
<pre><span class="code-comment"># src/handlers/llm/openai_compatible/llm_handler_openai_compatible.py</span>

<span class="code-keyword">from</span> openai <span class="code-keyword">import</span> OpenAI

<span class="code-keyword">class</span> <span class="code-function">HandlerLLM</span>:
    <span class="code-keyword">def</span> <span class="code-function">handle</span>(self, context, inputs: ChatData, output_definitions):
        <span class="code-string">"""å¤„ç†è¾“å…¥æ•°æ®"""</span>
        
        <span class="code-comment"># 1. æ¥æ”¶è§†é¢‘è¾“å…¥</span>
        <span class="code-keyword">if</span> inputs.type == ChatDataType.CAMERA_VIDEO:
            <span class="code-keyword">if</span> context.enable_video_input:
                <span class="code-comment"># å­˜å‚¨å½“å‰è§†é¢‘å¸§ï¼Œç­‰å¾…æ–‡æœ¬è¾“å…¥è§¦å‘æ¨ç†</span>
                video_frame = inputs.data.get_main_data()  <span class="code-comment"># shape: (1, H, W, 3)</span>
                context.current_image = video_frame
                print(<span class="code-string">f"ğŸ“¹ æ¥æ”¶åˆ°è§†é¢‘å¸§ï¼Œshape: {video_frame.shape}"</span>)
            <span class="code-keyword">return</span>  <span class="code-comment"># ä»…å­˜å‚¨ï¼Œä¸è§¦å‘æ¨ç†</span>
        
        <span class="code-comment"># 2. æ¥æ”¶æ–‡æœ¬è¾“å…¥ï¼ˆç”¨æˆ·è¯´è¯ç»“æŸï¼‰</span>
        <span class="code-keyword">elif</span> inputs.type == ChatDataType.HUMAN_TEXT:
            text = inputs.data.get_main_data()
            print(<span class="code-string">f"ğŸ’¬ ç”¨æˆ·è¯´: {text}"</span>)
            
            <span class="code-comment"># 3. æ„å»ºå¤šæ¨¡æ€æ¶ˆæ¯</span>
            messages = self._build_messages(text, context.current_image)
            
            <span class="code-comment"># 4. è°ƒç”¨OpenAIå…¼å®¹APIï¼ˆæ”¯æŒé˜¿é‡Œäº‘ç™¾ç‚¼ã€Ollamaç­‰ï¼‰</span>
            response = self.client.chat.completions.create(
                model=<span class="code-string">"qwen3-vl-plus"</span>,  <span class="code-comment"># å¤šæ¨¡æ€æ¨¡å‹</span>
                messages=messages,
                stream=<span class="code-keyword">True</span>              <span class="code-comment"># æµå¼è¾“å‡º</span>
            )
            
            <span class="code-comment"># 5. æµå¼è¿”å›AIå“åº”</span>
            <span class="code-keyword">for</span> chunk <span class="code-keyword">in</span> response:
                <span class="code-keyword">if</span> chunk.choices[0].delta.content:
                    ai_text = chunk.choices[0].delta.content
                    self._submit_ai_response(ai_text)
    
    <span class="code-keyword">def</span> <span class="code-function">_build_messages</span>(self, text: str, image: np.ndarray):
        <span class="code-string">"""æ„å»ºå¤šæ¨¡æ€æ¶ˆæ¯"""</span>
        messages = [{<span class="code-string">"role"</span>: <span class="code-string">"system"</span>, <span class="code-string">"content"</span>: self.system_prompt}]
        
        <span class="code-comment"># æ·»åŠ å†å²å¯¹è¯</span>
        messages.extend(self.history.get_messages())
        
        <span class="code-comment"># æ„å»ºå½“å‰æ¶ˆæ¯</span>
        <span class="code-keyword">if</span> image <span class="code-keyword">is not None</span>:
            <span class="code-comment"># å¤šæ¨¡æ€æ¶ˆæ¯ï¼šæ–‡å­— + å›¾ç‰‡</span>
            image_url = ImageUtils.numpy2base64(image)
            current_message = {
                <span class="code-string">"role"</span>: <span class="code-string">"user"</span>,
                <span class="code-string">"content"</span>: [
                    {<span class="code-string">"type"</span>: <span class="code-string">"text"</span>, <span class="code-string">"text"</span>: text},
                    {<span class="code-string">"type"</span>: <span class="code-string">"image_url"</span>, <span class="code-string">"image_url"</span>: {<span class="code-string">"url"</span>: image_url}}
                ]
            }
        <span class="code-keyword">else</span>:
            <span class="code-comment"># çº¯æ–‡æœ¬æ¶ˆæ¯</span>
            current_message = {
                <span class="code-string">"role"</span>: <span class="code-string">"user"</span>,
                <span class="code-string">"content"</span>: text
            }
        
        messages.append(current_message)
        <span class="code-keyword">return</span> messages</pre>
                </div>

                <h3 class="subsection-title">5. APIè°ƒç”¨ç¤ºä¾‹</h3>
                <div class="code-block" data-lang="JSON">
<pre><span class="code-comment">// å‘é€ç»™Qwen-VL-Plusçš„æ¶ˆæ¯æ ¼å¼</span>
{
  <span class="code-string">"model"</span>: <span class="code-string">"qwen3-vl-plus"</span>,
  <span class="code-string">"messages"</span>: [
    {
      <span class="code-string">"role"</span>: <span class="code-string">"system"</span>,
      <span class="code-string">"content"</span>: <span class="code-string">"ä½ æ˜¯ä¸€ä¸ªAIåŠ©æ‰‹ï¼Œèƒ½ç†è§£å›¾åƒå’Œæ–‡å­—..."</span>
    },
    {
      <span class="code-string">"role"</span>: <span class="code-string">"user"</span>,
      <span class="code-string">"content"</span>: [
        {
          <span class="code-string">"type"</span>: <span class="code-string">"text"</span>,
          <span class="code-string">"text"</span>: <span class="code-string">"è¿™æ˜¯ä»€ä¹ˆï¼Ÿ"</span>  <span class="code-comment">// ç”¨æˆ·è¯­éŸ³è¯†åˆ«çš„æ–‡å­—</span>
        },
        {
          <span class="code-string">"type"</span>: <span class="code-string">"image_url"</span>,
          <span class="code-string">"image_url"</span>: {
            <span class="code-string">"url"</span>: <span class="code-string">"data:image/jpeg;base64,/9j/4AAQSkZJRg..."</span>  <span class="code-comment">// æ‘„åƒå¤´ç”»é¢</span>
          }
        }
      ]
    }
  ],
  <span class="code-string">"stream"</span>: <span class="code-keyword">true</span>
}

<span class="code-comment">// AIå“åº”ç¤ºä¾‹</span>
{
  <span class="code-string">"choices"</span>: [
    {
      <span class="code-string">"delta"</span>: {
        <span class="code-string">"content"</span>: <span class="code-string">"æˆ‘çœ‹åˆ°ä½ æ‰‹é‡Œæ‹¿ç€ä¸€ä¸ªçº¢è‰²çš„è‹¹æœ..."</span>
      }
    }
  ]
}</pre>
                </div>
            </div>

            <!-- å±å¹•å…±äº« -->
            <div class="section">
                <h2 class="section-title">ğŸ–¥ï¸ å±å¹•å…±äº«å®ç°åŸç†</h2>

                <h3 class="subsection-title">æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•è®©AIçœ‹åˆ°ç”¨æˆ·çš„ç”µè„‘å±å¹•ï¼Ÿ</h3>
                <div class="highlight-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-left-color: #a8edea;">
                    <strong>ç­”æ¡ˆï¼šé€šè¿‡WebRTCè½¨é“æ›¿æ¢æœºåˆ¶ï¼</strong><br><br>
                    <strong>å…³é”®æŠ€æœ¯ï¼š</strong><code>getDisplayMedia()</code> APIè·å–å±å¹•æµ â†’ 
                    <code>replaceTrack()</code>æ›¿æ¢æ‘„åƒå¤´è§†é¢‘è½¨é“ â†’ 
                    AIæ¥æ”¶å±å¹•ç”»é¢ï¼ˆè€Œä¸æ˜¯æ‘„åƒå¤´ç”»é¢ï¼‰â†’ 
                    å±å¹•å†…å®¹é€šè¿‡ç›¸åŒçš„è§†é¢‘å¸§å¤„ç†æµç¨‹ä¼ ç»™VLå¤§æ¨¡å‹
                </div>

                <h3 class="subsection-title">1. å‰ç«¯ï¼šå±å¹•æ•è·</h3>
                <div class="code-block" data-lang="TypeScript">
<pre><span class="code-comment">// OpenAvatarChat-WebUI/src/utils/screenShareUtils.ts</span>

<span class="code-keyword">export async function</span> <span class="code-function">getOptimizedDisplayStream</span>(options) {
  <span class="code-keyword">try</span> {
    <span class="code-comment">// 1. è¯·æ±‚å±å¹•å…±äº«æƒé™</span>
    <span class="code-keyword">const</span> displayStream = <span class="code-keyword">await</span> navigator.mediaDevices.getDisplayMedia({
      video: {
        width: { ideal: 1280, max: 1920 },    <span class="code-comment">// å±å¹•åˆ†è¾¨ç‡</span>
        height: { ideal: 720, max: 1080 },
        frameRate: { ideal: 15, max: 20 },    <span class="code-comment">// å¸§ç‡ï¼ˆé™ä½ä»¥å‡å°‘å¸¦å®½ï¼‰</span>
        cursor: <span class="code-string">'always'</span>,                      <span class="code-comment">// åŒ…å«é¼ æ ‡å…‰æ ‡</span>
        displaySurface: <span class="code-string">'monitor'</span>             <span class="code-comment">// æ•è·ç±»å‹ï¼šmonitor/window/browser</span>
      },
      audio: {
        echoCancellation: <span class="code-keyword">true</span>,
        noiseSuppression: <span class="code-keyword">true</span>,
        systemAudio: <span class="code-keyword">true</span>                    <span class="code-comment">// åŒ…å«ç³»ç»ŸéŸ³é¢‘</span>
      }
    });
    
    <span class="code-comment">// 2. ç›‘å¬ç”¨æˆ·åœæ­¢å…±äº«äº‹ä»¶ï¼ˆç‚¹å‡»æµè§ˆå™¨åœæ­¢æŒ‰é’®ï¼‰</span>
    displayStream.getVideoTracks()[0].addEventListener(<span class="code-string">'ended'</span>, () => {
      console.log(<span class="code-string">'ğŸ›‘ ç”¨æˆ·åœæ­¢å±å¹•å…±äº«'</span>);
      window.dispatchEvent(<span class="code-keyword">new</span> CustomEvent(<span class="code-string">'screenShareEnded'</span>));
    });
    
    <span class="code-keyword">return</span> displayStream;
    
  } <span class="code-keyword">catch</span> (error) {
    console.error(<span class="code-string">'âŒ å±å¹•æ•è·å¤±è´¥:'</span>, error);
    <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">'å±å¹•å…±äº«å¯åŠ¨å¤±è´¥'</span>);
  }
}</pre>
                </div>

                <h3 class="subsection-title">2. WebRTCè§†é¢‘è½¨é“æ›¿æ¢</h3>
                <div class="code-block" data-lang="TypeScript">
<pre><span class="code-comment">// OpenAvatarChat-WebUI/src/store/screenShareStore.ts</span>

<span class="code-keyword">async function</span> <span class="code-function">startScreenShare</span>() {
  <span class="code-keyword">try</span> {
    console.log(<span class="code-string">'ğŸš€ å¼€å§‹å±å¹•å…±äº«...'</span>);
    
    <span class="code-comment">// 1. è®°ä½å½“å‰æ‘„åƒå¤´æ˜¾ç¤ºçŠ¶æ€</span>
    <span class="code-keyword">const</span> videoChatStore = useVideoChatStore();
    cameraStateBeforeScreenShare = !videoChatStore.cameraOff;
    
    <span class="code-comment">// 2. è‡ªåŠ¨å…³é—­æ‘„åƒå¤´æ˜¾ç¤ºï¼ˆé¿å…å¹²æ‰°ï¼‰</span>
    <span class="code-keyword">if</span> (cameraStateBeforeScreenShare) {
      console.log(<span class="code-string">'ğŸ“· è‡ªåŠ¨å…³é—­æ‘„åƒå¤´æ˜¾ç¤º'</span>);
      videoChatStore.handleCameraOff();
    }
    
    <span class="code-comment">// 3. è·å–å±å¹•å…±äº«æµ</span>
    <span class="code-keyword">const</span> displayStream = <span class="code-keyword">await</span> getOptimizedDisplayStream({
      video: <span class="code-keyword">true</span>,
      audio: screenShareOptions.includeSystemAudio,
      quality: screenShareOptions.quality
    });
    
    <span class="code-comment">// 4. ğŸ”¥ å…³é”®ï¼šæ›¿æ¢WebRTCè§†é¢‘è½¨é“</span>
    <span class="code-keyword">await</span> replaceVideoTrack(displayStream);
    
    <span class="code-comment">// 5. æ›´æ–°çŠ¶æ€</span>
    screenShareStream = displayStream;
    isScreenSharing.value = <span class="code-keyword">true</span>;
    
    console.log(<span class="code-string">'ğŸ‰ å±å¹•å…±äº«å¯åŠ¨æˆåŠŸï¼AIç°åœ¨èƒ½çœ‹åˆ°å±å¹•å†…å®¹'</span>);
    
  } <span class="code-keyword">catch</span> (error) {
    console.error(<span class="code-string">'âŒ å±å¹•å…±äº«å¯åŠ¨å¤±è´¥:'</span>, error);
    <span class="code-keyword">throw</span> error;
  }
}

<span class="code-comment">/**
 * æ ¸å¿ƒå‡½æ•°ï¼šæ›¿æ¢WebRTCè§†é¢‘è½¨é“
 * è¿™æ˜¯è®©AIçœ‹åˆ°å±å¹•å†…å®¹çš„å…³é”®ï¼
 */</span>
<span class="code-keyword">async function</span> <span class="code-function">replaceVideoTrack</span>(newStream: MediaStream) {
  <span class="code-keyword">const</span> peerConnection = getPeerConnection();
  <span class="code-keyword">if</span> (!peerConnection) <span class="code-keyword">return</span>;
  
  <span class="code-comment">// 1. æ‰¾åˆ°å½“å‰çš„è§†é¢‘å‘é€å™¨ï¼ˆSenderï¼‰</span>
  <span class="code-keyword">const</span> videoSender = peerConnection.getSenders().find(
    sender => sender.track && sender.track.kind === <span class="code-string">'video'</span>
  );
  
  <span class="code-keyword">if</span> (videoSender && newStream.getVideoTracks().length > 0) {
    <span class="code-keyword">const</span> newVideoTrack = newStream.getVideoTracks()[0];
    
    console.log(<span class="code-string">'ğŸ” è½¨é“æ›¿æ¢è¯¦æƒ…:'</span>, {
      oldTrack: videoSender.track?.label,        <span class="code-comment">// åŸè½¨é“ï¼šæ‘„åƒå¤´</span>
      newTrack: newVideoTrack.label,             <span class="code-comment">// æ–°è½¨é“ï¼šå±å¹•å…±äº«</span>
      newTrackEnabled: newVideoTrack.enabled,
      newTrackReadyState: newVideoTrack.readyState
    });
    
    <span class="code-comment">// 2. ğŸ”¥ æ ¸å¿ƒAPIè°ƒç”¨ï¼šæ›¿æ¢è§†é¢‘è½¨é“</span>
    <span class="code-keyword">await</span> videoSender.replaceTrack(newVideoTrack);
    
    console.log(<span class="code-string">'ğŸ“¹ è§†é¢‘è½¨é“å·²æˆåŠŸæ›¿æ¢ï¼'</span>);
    console.log(<span class="code-string">'âœ… AIç°åœ¨æ¥æ”¶å±å¹•å†…å®¹è€Œä¸æ˜¯æ‘„åƒå¤´ç”»é¢'</span>);
  }
}

<span class="code-comment">/**
 * åœæ­¢å±å¹•å…±äº«å¹¶æ¢å¤æ‘„åƒå¤´
 */</span>
<span class="code-keyword">async function</span> <span class="code-function">stopScreenShare</span>() {
  <span class="code-keyword">try</span> {
    console.log(<span class="code-string">'ğŸ›‘ åœæ­¢å±å¹•å…±äº«...'</span>);
    
    <span class="code-comment">// 1. åœæ­¢å±å¹•å…±äº«æµ</span>
    <span class="code-keyword">if</span> (screenShareStream) {
      screenShareStream.getTracks().forEach(track => track.stop());
    }
    
    <span class="code-comment">// 2. ğŸ”¥ å…³é”®ï¼šæ¢å¤æ‘„åƒå¤´è½¨é“</span>
    <span class="code-keyword">const</span> videoChatStore = useVideoChatStore();
    <span class="code-keyword">if</span> (videoChatStore.localStream) {
      <span class="code-keyword">await</span> replaceVideoTrack(videoChatStore.localStream);
      console.log(<span class="code-string">'ğŸ‰ å·²æ¢å¤æ‘„åƒå¤´è½¨é“ï¼ŒAIé‡æ–°çœ‹åˆ°æ‘„åƒå¤´'</span>);
    }
    
    <span class="code-comment">// 3. è‡ªåŠ¨æ¢å¤æ‘„åƒå¤´æ˜¾ç¤ºçŠ¶æ€</span>
    <span class="code-keyword">if</span> (cameraStateBeforeScreenShare && videoChatStore.cameraOff) {
      console.log(<span class="code-string">'ğŸ“· è‡ªåŠ¨æ¢å¤æ‘„åƒå¤´æ˜¾ç¤º'</span>);
      videoChatStore.handleCameraOff();
    }
    
    <span class="code-comment">// 4. æ›´æ–°çŠ¶æ€</span>
    screenShareStream = <span class="code-keyword">null</span>;
    isScreenSharing.value = <span class="code-keyword">false</span>;
    
    console.log(<span class="code-string">'âœ… å±å¹•å…±äº«å·²åœæ­¢'</span>);
    
  } <span class="code-keyword">catch</span> (error) {
    console.error(<span class="code-string">'âŒ åœæ­¢å±å¹•å…±äº«å¤±è´¥:'</span>, error);
  }
}</pre>
                </div>

                <h3 class="subsection-title">3. åç«¯ï¼šç»Ÿä¸€çš„è§†é¢‘å¸§å¤„ç†</h3>
                <p>
                    å±å¹•å…±äº«çš„å…³é”®åœ¨äºï¼š<strong>æ›¿æ¢è§†é¢‘è½¨é“åï¼Œåç«¯æ¥æ”¶åˆ°çš„è§†é¢‘å¸§å°±æ˜¯å±å¹•å†…å®¹</strong>ï¼Œ
                    æ— éœ€ä¿®æ”¹åç«¯ä»£ç ï¼æ•´ä¸ªè§†é¢‘å¸§å¤„ç†æµç¨‹ï¼ˆWebRTCæ¥æ”¶ â†’ NumPyè½¬æ¢ â†’ Base64ç¼–ç  â†’ LLMå¤„ç†ï¼‰
                    <strong>å®Œå…¨å¤ç”¨æ‘„åƒå¤´çš„ä»£ç è·¯å¾„</strong>ã€‚
                </p>

                <div class="code-block" data-lang="Python">
<pre><span class="code-comment"># åç«¯æ— éœ€åŒºåˆ†æ‘„åƒå¤´è¿˜æ˜¯å±å¹•å…±äº«ï¼</span>
<span class="code-comment"># è§†é¢‘å¸§å¤„ç†æµç¨‹å®Œå…¨ç›¸åŒ</span>

<span class="code-keyword">async def</span> <span class="code-function">_process_video_frames</span>(self, track):
    <span class="code-string">"""ç»Ÿä¸€çš„è§†é¢‘å¸§å¤„ç†ï¼ˆæ‘„åƒå¤´æˆ–å±å¹•å…±äº«ï¼‰"""</span>
    <span class="code-keyword">while</span> <span class="code-keyword">True</span>:
        frame = <span class="code-keyword">await</span> track.recv()  <span class="code-comment"># æ¥æ”¶è§†é¢‘å¸§</span>
        
        <span class="code-comment"># âœ… è¿™é‡Œçš„frameå¯èƒ½æ˜¯ï¼š</span>
        <span class="code-comment">#    - æ‘„åƒå¤´ç”»é¢ï¼ˆç”¨æˆ·äººè„¸ï¼‰</span>
        <span class="code-comment">#    - å±å¹•å…±äº«ç”»é¢ï¼ˆç”¨æˆ·ç”µè„‘å±å¹•ï¼‰</span>
        <span class="code-comment"># åç«¯ä¸éœ€è¦çŸ¥é“ï¼Œå¤„ç†æµç¨‹å®Œå…¨ä¸€æ ·ï¼</span>
        
        video_array = frame.to_ndarray(format=<span class="code-string">"rgb24"</span>)
        video_array = video_array[np.newaxis, ...]
        
        chat_data = ChatData(
            type=ChatDataType.CAMERA_VIDEO,  <span class="code-comment"># ç»Ÿä¸€æ ‡è®°ä¸ºè§†é¢‘è¾“å…¥</span>
            data=DataBundle(video_array)
        )
        
        self.data_submitter.submit(chat_data)  <span class="code-comment"># æäº¤åˆ°LLM Handler</span></pre>
                </div>

                <h3 class="subsection-title">4. VLå¤§æ¨¡å‹æ¥æ”¶å±å¹•å†…å®¹</h3>
                <p>
                    å½“å±å¹•å…±äº«å¯åŠ¨åï¼ŒAIæ¥æ”¶åˆ°çš„å›¾åƒä»"ç”¨æˆ·äººè„¸"å˜æˆäº†"ç”µè„‘å±å¹•"ï¼Œ
                    ä½†<strong>APIè°ƒç”¨æ ¼å¼å®Œå…¨ç›¸åŒ</strong>ï¼š
                </p>

                <div class="code-block" data-lang="JSON">
<pre><span class="code-comment">// æ‘„åƒå¤´æ¨¡å¼ï¼ˆAIçœ‹åˆ°ç”¨æˆ·äººè„¸ï¼‰</span>
{
  <span class="code-string">"model"</span>: <span class="code-string">"qwen3-vl-plus"</span>,
  <span class="code-string">"messages"</span>: [
    {
      <span class="code-string">"role"</span>: <span class="code-string">"user"</span>,
      <span class="code-string">"content"</span>: [
        {<span class="code-string">"type"</span>: <span class="code-string">"text"</span>, <span class="code-string">"text"</span>: <span class="code-string">"ä½ çœ‹åˆ°ä»€ä¹ˆï¼Ÿ"</span>},
        {<span class="code-string">"type"</span>: <span class="code-string">"image_url"</span>, <span class="code-string">"image_url"</span>: {<span class="code-string">"url"</span>: <span class="code-string">"data:image/jpeg;base64,..."</span>}}
      ]
    }
  ]
}
<span class="code-comment">// AIå“åº”: "æˆ‘çœ‹åˆ°ä¸€ä¸ªäººååœ¨æ¡Œå‰ï¼Œæ‰‹é‡Œæ‹¿ç€å’–å•¡æ¯..."</span>

<span class="code-comment">// å±å¹•å…±äº«æ¨¡å¼ï¼ˆAIçœ‹åˆ°ç”µè„‘å±å¹•ï¼‰</span>
{
  <span class="code-string">"model"</span>: <span class="code-string">"qwen3-vl-plus"</span>,
  <span class="code-string">"messages"</span>: [
    {
      <span class="code-string">"role"</span>: <span class="code-string">"user"</span>,
      <span class="code-string">"content"</span>: [
        {<span class="code-string">"type"</span>: <span class="code-string">"text"</span>, <span class="code-string">"text"</span>: <span class="code-string">"ä½ çœ‹åˆ°ä»€ä¹ˆï¼Ÿ"</span>},
        {<span class="code-string">"type"</span>: <span class="code-string">"image_url"</span>, <span class="code-string">"image_url"</span>: {<span class="code-string">"url"</span>: <span class="code-string">"data:image/jpeg;base64,..."</span>}}  <span class="code-comment">â† è¿™é‡Œæ˜¯å±å¹•æˆªå›¾</span>
      ]
    }
  ]
}
<span class="code-comment">// AIå“åº”: "æˆ‘çœ‹åˆ°ä½ çš„ç”µè„‘æ¡Œé¢ï¼Œæœ‰Chromeæµè§ˆå™¨æ‰“å¼€ç€GitHubé¡µé¢..."</span></pre>
                </div>
            </div>

            <!-- å®Œæ•´æµç¨‹ -->
            <div class="section">
                <h2 class="section-title">ğŸ”„ ç«¯åˆ°ç«¯äº¤äº’å®Œæ•´æµç¨‹</h2>

                <div class="flow-diagram">
                    <h3 style="color: #43e97b; margin-bottom: 30px; text-align: center;">åœºæ™¯ä¸€ï¼šæ‘„åƒå¤´è§†é¢‘å¯¹è¯</h3>

                    <div class="flow-step" data-step="1">
                        <h4>ğŸ‘¤ ç”¨æˆ·å¼€å¯æ‘„åƒå¤´å’Œéº¦å…‹é£</h4>
                        <p>
                            æµè§ˆå™¨è°ƒç”¨<code>getUserMedia()</code>è·å–åª’ä½“æµ<br>
                            è§†é¢‘ï¼š640x480@30fpsï¼ŒéŸ³é¢‘ï¼š16kHzå•å£°é“
                        </p>
                    </div>

                    <div class="flow-step" data-step="2">
                        <h4>ğŸŒ å»ºç«‹WebRTCè¿æ¥</h4>
                        <p>
                            å‰ç«¯åˆ›å»º<code>RTCPeerConnection</code>ï¼Œæ·»åŠ è§†é¢‘/éŸ³é¢‘è½¨é“<br>
                            é€šè¿‡STUN/TURNæœåŠ¡å™¨å®ŒæˆNATç©¿é€ï¼Œå»ºç«‹P2Pè¿æ¥
                        </p>
                    </div>

                    <div class="flow-step" data-step="3">
                        <h4>ğŸ“¡ åª’ä½“æµä¼ è¾“åˆ°æœåŠ¡ç«¯</h4>
                        <p>
                            <strong>è§†é¢‘ï¼š</strong>30fpsè§†é¢‘å¸§å®æ—¶ä¼ è¾“ï¼ˆUDPåè®®ï¼‰<br>
                            <strong>éŸ³é¢‘ï¼š</strong>è¿ç»­éŸ³é¢‘æµå®æ—¶ä¼ è¾“ï¼ˆ16kHz PCMï¼‰
                        </p>
                    </div>

                    <div class="flow-step" data-step="4">
                        <h4>ğŸ¤ ç”¨æˆ·å¼€å§‹è¯´è¯</h4>
                        <p>
                            <strong>VAD Handlerï¼š</strong>Silero VADå®æ—¶æ£€æµ‹è¯­éŸ³æ´»åŠ¨<br>
                            æ£€æµ‹åˆ°è¯­éŸ³èµ·å§‹ â†’ å¼€å§‹å½•éŸ³ç¼“å†²
                        </p>
                    </div>

                    <div class="flow-step" data-step="5">
                        <h4>ğŸ‘‚ è¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰</h4>
                        <p>
                            ç”¨æˆ·è¯´è¯ç»“æŸ â†’ VADæ£€æµ‹åˆ°è¯­éŸ³ç»ˆæ­¢<br>
                            <strong>ASR Handlerï¼š</strong>SenseVoiceæ¨¡å‹å°†éŸ³é¢‘è½¬ä¸ºæ–‡å­—<br>
                            è¾“å‡ºï¼š<code>"è¿™æ˜¯ä»€ä¹ˆï¼Ÿ"</code>
                        </p>
                    </div>

                    <div class="flow-step" data-step="6">
                        <h4>ğŸ“¹ æå–æœ€æ–°è§†é¢‘å¸§</h4>
                        <p>
                            ä»è§†é¢‘æµä¸­è·å–æœ€æ–°ä¸€å¸§ï¼ˆå¯¹åº”ç”¨æˆ·è¯´è¯æ—¶çš„ç”»é¢ï¼‰<br>
                            NumPyæ•°ç»„ (1, 480, 640, 3) â†’ JPEGå‹ç¼© â†’ Base64ç¼–ç 
                        </p>
                    </div>

                    <div class="flow-step" data-step="7">
                        <h4>ğŸ§  å¤šæ¨¡æ€LLMæ¨ç†</h4>
                        <p>
                            æ„å»ºæ¶ˆæ¯ï¼š<code>["è¿™æ˜¯ä»€ä¹ˆï¼Ÿ", image_base64]</code><br>
                            è°ƒç”¨Qwen-VL-Plus APIè¿›è¡Œè§†è§‰ç†è§£<br>
                            AIå“åº”ï¼š<code>"æˆ‘çœ‹åˆ°ä½ æ‰‹é‡Œæ‹¿ç€ä¸€ä¸ªçº¢è‰²çš„è‹¹æœ..."</code>
                        </p>
                    </div>

                    <div class="flow-step" data-step="8">
                        <h4>ğŸ”Š è¯­éŸ³åˆæˆï¼ˆTTSï¼‰</h4>
                        <p>
                            <strong>TTS Handlerï¼š</strong>å°†AIæ–‡æœ¬è½¬ä¸ºè¯­éŸ³<br>
                            CosyVoiceæ¨¡å‹ç”Ÿæˆè‡ªç„¶è¯­éŸ³ï¼ˆ16kHz PCMï¼‰
                        </p>
                    </div>

                    <div class="flow-step" data-step="9">
                        <h4>ğŸ­ æ•°å­—äººè§†é¢‘ç”Ÿæˆ</h4>
                        <p>
                            <strong>Avatar Handlerï¼š</strong>æ ¹æ®AIè¯­éŸ³é©±åŠ¨æ•°å­—äººå£å‹å’Œè¡¨æƒ…<br>
                            LiteAvatarç”Ÿæˆæ•°å­—äººè§†é¢‘ï¼ˆ25-30fpsï¼‰
                        </p>
                    </div>

                    <div class="flow-step" data-step="10">
                        <h4>ğŸ“¤ è¿”å›ç»™ç”¨æˆ·</h4>
                        <p>
                            æ•°å­—äººè§†é¢‘ + AIè¯­éŸ³é€šè¿‡WebRTCè¿”å›æµè§ˆå™¨<br>
                            ç”¨æˆ·çœ‹åˆ°æ•°å­—äººè¯´è¯ã€å¬åˆ°AIå›ç­”<br>
                            <strong>ç«¯åˆ°ç«¯å»¶è¿Ÿï¼š~2.2ç§’</strong>
                        </p>
                    </div>
                </div>

                <div class="flow-diagram">
                    <h3 style="color: #43e97b; margin-bottom: 30px; text-align: center;">åœºæ™¯äºŒï¼šå±å¹•å…±äº«+AIåˆ†æ</h3>

                    <div class="flow-step" data-step="1">
                        <h4>ğŸ‘¤ ç”¨æˆ·ç‚¹å‡»"å±å¹•å…±äº«"æŒ‰é’®</h4>
                        <p>
                            å‰ç«¯è°ƒç”¨<code>getDisplayMedia()</code>è·å–å±å¹•æµ<br>
                            ç”¨æˆ·é€‰æ‹©è¦å…±äº«çš„çª—å£/å±å¹•/æ ‡ç­¾é¡µ
                        </p>
                    </div>

                    <div class="flow-step" data-step="2">
                        <h4>ğŸ”„ æ›¿æ¢WebRTCè§†é¢‘è½¨é“</h4>
                        <p>
                            è°ƒç”¨<code>videoSender.replaceTrack(screenTrack)</code><br>
                            åŸæ‘„åƒå¤´è½¨é“è¢«æ›¿æ¢ä¸ºå±å¹•å…±äº«è½¨é“<br>
                            <strong>å…³é”®ï¼šAIä»æ­¤åˆ»å¼€å§‹æ¥æ”¶å±å¹•ç”»é¢è€Œä¸æ˜¯æ‘„åƒå¤´ç”»é¢</strong>
                        </p>
                    </div>

                    <div class="flow-step" data-step="3">
                        <h4>ğŸ“¡ å±å¹•ç”»é¢ä¼ è¾“åˆ°æœåŠ¡ç«¯</h4>
                        <p>
                            å±å¹•å†…å®¹ä»¥15-20fpsä¼ è¾“ï¼ˆé™ä½å¸§ç‡èŠ‚çœå¸¦å®½ï¼‰<br>
                            åˆ†è¾¨ç‡ï¼š1280x720æˆ–1920x1080
                        </p>
                    </div>

                    <div class="flow-step" data-step="4">
                        <h4>ğŸ¤ ç”¨æˆ·æé—®å±å¹•å†…å®¹</h4>
                        <p>
                            ç”¨æˆ·è¯´ï¼š<code>"è¿™ä¸ªé¡µé¢ä¸Šçš„é”™è¯¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"</code><br>
                            VADæ£€æµ‹è¯­éŸ³ â†’ ASRè¯†åˆ«æ–‡å­—
                        </p>
                    </div>

                    <div class="flow-step" data-step="5">
                        <h4>ğŸ“¸ æå–å±å¹•ç”»é¢å¸§</h4>
                        <p>
                            ä»å±å¹•å…±äº«æµä¸­æå–å½“å‰å¸§<br>
                            <strong>è¿™ä¸€å¸§åŒ…å«ï¼š</strong>æµè§ˆå™¨çª—å£ã€é”™è¯¯ä¿¡æ¯ã€ä»£ç ç¼–è¾‘å™¨ç­‰
                        </p>
                    </div>

                    <div class="flow-step" data-step="6">
                        <h4>ğŸ§  VLå¤§æ¨¡å‹åˆ†æå±å¹•å†…å®¹</h4>
                        <p>
                            AIæ¥æ”¶ï¼š<code>["è¿™ä¸ªé¡µé¢ä¸Šçš„é”™è¯¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ", å±å¹•æˆªå›¾]</code><br>
                            Qwen-VL-Plusç†è§£å±å¹•å†…å®¹ï¼š<br>
                            <em>"æˆ‘çœ‹åˆ°ä½ çš„æµè§ˆå™¨æ˜¾ç¤ºäº†ä¸€ä¸ªJavaScripté”™è¯¯ï¼š'Cannot read property of undefined'ã€‚
                            è¿™é€šå¸¸æ˜¯å› ä¸ºä½ å°è¯•è®¿é—®ä¸€ä¸ªæœªå®šä¹‰å˜é‡çš„å±æ€§ã€‚å»ºè®®æ£€æŸ¥ç¬¬15è¡Œçš„ä»£ç ..."</em>
                        </p>
                    </div>

                    <div class="flow-step" data-step="7">
                        <h4>ğŸ”Š TTS + æ•°å­—äººå“åº”</h4>
                        <p>
                            AIåˆ†æç»“æœè½¬ä¸ºè¯­éŸ³å’Œæ•°å­—äººè§†é¢‘<br>
                            è¿”å›ç»™ç”¨æˆ·ï¼Œæä¾›å…·ä½“çš„è§£å†³å»ºè®®
                        </p>
                    </div>

                    <div class="flow-step" data-step="8">
                        <h4>ğŸ›‘ åœæ­¢å±å¹•å…±äº«</h4>
                        <p>
                            ç”¨æˆ·ç‚¹å‡»åœæ­¢æŒ‰é’®<br>
                            è°ƒç”¨<code>replaceTrack(cameraTrack)</code>æ¢å¤æ‘„åƒå¤´è½¨é“<br>
                            <strong>AIé‡æ–°çœ‹åˆ°ç”¨æˆ·äººè„¸</strong>
                        </p>
                    </div>
                </div>
            </div>

            <!-- æŠ€æœ¯æ ˆ -->
            <div class="section">
                <h2 class="section-title">ğŸ› ï¸ å®Œæ•´æŠ€æœ¯æ ˆ</h2>

                <h3 class="subsection-title">å‰ç«¯æŠ€æœ¯</h3>
                <div class="tech-stack">
                    <div class="tech-item">
                        <h4>Vue 3 + TypeScript</h4>
                        <p>Composition APIã€å“åº”å¼çŠ¶æ€ç®¡ç†ã€ç±»å‹å®‰å…¨</p>
                    </div>
                    <div class="tech-item">
                        <h4>WebRTC API</h4>
                        <p>getUserMediaã€getDisplayMediaã€RTCPeerConnection</p>
                    </div>
                    <div class="tech-item">
                        <h4>MediaStream API</h4>
                        <p>è§†é¢‘è½¨é“æ§åˆ¶ã€éŸ³é¢‘é‡‡é›†ã€replaceTrack</p>
                    </div>
                    <div class="tech-item">
                        <h4>Pinia</h4>
                        <p>Vue3çŠ¶æ€ç®¡ç†åº“ï¼Œç®¡ç†WebRTCçŠ¶æ€å’Œå±å¹•å…±äº«çŠ¶æ€</p>
                    </div>
                </div>

                <h3 class="subsection-title">åç«¯æŠ€æœ¯</h3>
                <div class="tech-stack">
                    <div class="tech-item">
                        <h4>aiortc</h4>
                        <p>Python WebRTCå®ç°ï¼Œæ”¯æŒasyncioå¼‚æ­¥ç¼–ç¨‹</p>
                    </div>
                    <div class="tech-item">
                        <h4>FastAPI</h4>
                        <p>ç°ä»£Python Webæ¡†æ¶ï¼Œæ”¯æŒWebSocketå®æ—¶é€šä¿¡</p>
                    </div>
                    <div class="tech-item">
                        <h4>NumPy + OpenCV</h4>
                        <p>è§†é¢‘å¸§å¤„ç†ã€å›¾åƒè½¬æ¢ã€é¢œè‰²ç©ºé—´å˜æ¢</p>
                    </div>
                    <div class="tech-item">
                        <h4>Pillow (PIL)</h4>
                        <p>å›¾åƒç¼–ç ã€JPEGå‹ç¼©ã€Base64è½¬æ¢</p>
                    </div>
                </div>

                <h3 class="subsection-title">AIæ¨¡å‹</h3>
                <div class="tech-stack">
                    <div class="tech-item">
                        <h4>Qwen-VL-Plus</h4>
                        <p>å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹ï¼Œæ”¯æŒå›¾åƒ+æ–‡æœ¬ç†è§£</p>
                    </div>
                    <div class="tech-item">
                        <h4>SenseVoice</h4>
                        <p>è¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰ï¼Œæ”¯æŒå¤šè¯­è¨€ã€æ ‡ç‚¹ã€æƒ…æ„Ÿè¯†åˆ«</p>
                    </div>
                    <div class="tech-item">
                        <h4>CosyVoice</h4>
                        <p>é«˜è´¨é‡è¯­éŸ³åˆæˆï¼ˆTTSï¼‰ï¼Œè‡ªç„¶æµç•…çš„è¯­éŸ³è¾“å‡º</p>
                    </div>
                    <div class="tech-item">
                        <h4>LiteAvatar</h4>
                        <p>2Dæ•°å­—äººæ¸²æŸ“ï¼ŒéŸ³é¢‘é©±åŠ¨å£å‹å’Œè¡¨æƒ…</p>
                    </div>
                </div>

                <h3 class="subsection-title">ç½‘ç»œä¸é€šä¿¡</h3>
                <div class="tech-stack">
                    <div class="tech-item">
                        <h4>STUN Server</h4>
                        <p>Googleå…¬å…±STUNæœåŠ¡ï¼Œç”¨äºNATç±»å‹æ£€æµ‹</p>
                    </div>
                    <div class="tech-item">
                        <h4>TURN Server</h4>
                        <p>coturnè‡ªå»ºä¸­ç»§æœåŠ¡å™¨ï¼Œè§£å†³ä¸¥æ ¼NATç©¿é€</p>
                    </div>
                    <div class="tech-item">
                        <h4>SSL/TLS</h4>
                        <p>HTTPSåŠ å¯†é€šä¿¡ï¼ŒWebRTCå®‰å…¨è¦æ±‚</p>
                    </div>
                    <div class="tech-item">
                        <h4>WebSocket</h4>
                        <p>å®æ—¶åŒå‘é€šä¿¡ï¼Œç”¨äºçŠ¶æ€åŒæ­¥å’Œæ§åˆ¶</p>
                    </div>
                </div>
            </div>

            <!-- æ ¸å¿ƒä¼˜åŠ¿ -->
            <div class="section">
                <h2 class="section-title">â­ æ ¸å¿ƒæŠ€æœ¯ä¼˜åŠ¿</h2>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h3><span class="feature-icon">âš¡</span>ä½å»¶è¿Ÿ</h3>
                        <p>
                            ç«¯åˆ°ç«¯å»¶è¿Ÿä»…<strong>~2.2ç§’</strong>ï¼Œé€šè¿‡ä¼˜åŒ–VADå‚æ•°ã€æµå¼LLMè¾“å‡ºã€
                            GPUåŠ é€Ÿæ¸²æŸ“å®ç°æ¥è¿‘å®æ—¶çš„äº¤äº’ä½“éªŒã€‚
                        </p>
                    </div>

                    <div class="feature-card">
                        <h3><span class="feature-icon">ğŸ‘ï¸</span>çœŸæ­£çš„è§†è§‰ç†è§£</h3>
                        <p>
                            ä¸æ˜¯ç®€å•çš„å›¾åƒæ ‡ç­¾ï¼Œè€Œæ˜¯<strong>æ·±åº¦ç†è§£</strong>åœºæ™¯å†…å®¹ã€
                            è¯†åˆ«ç‰©ä½“ã€ç†è§£æ–‡å­—ã€åˆ†æå…³ç³»ï¼Œå®ç°æ™ºèƒ½å¯¹è¯ã€‚
                        </p>
                    </div>

                    <div class="feature-card">
                        <h3><span class="feature-icon">ğŸ”„</span>æ— ç¼åˆ‡æ¢</h3>
                        <p>
                            æ‘„åƒå¤´ä¸å±å¹•å…±äº«ä¹‹é—´<strong>1ç§’å†…åˆ‡æ¢</strong>ï¼Œé€šè¿‡<code>replaceTrack</code>
                            APIå®ç°æ— éœ€æ–­å¼€è¿æ¥çš„æµç•…åˆ‡æ¢ã€‚
                        </p>
                    </div>

                    <div class="feature-card">
                        <h3><span class="feature-icon">ğŸŒ</span>è·¨ç½‘ç»œ</h3>
                        <p>
                            é€šè¿‡<strong>TURNæœåŠ¡å™¨</strong>å®ç°ä¸¥æ ¼NATç¯å¢ƒä¸‹çš„ç¨³å®šè¿æ¥ï¼Œ
                            æ”¯æŒå…¬ç½‘éƒ¨ç½²å’Œç§»åŠ¨ç½‘ç»œè®¿é—®ã€‚
                        </p>
                    </div>

                    <div class="feature-card">
                        <h3><span class="feature-icon">ğŸ”Œ</span>æ¨¡å—åŒ–</h3>
                        <p>
                            Handleræ’ä»¶æ¶æ„ï¼Œå¯çµæ´»æ›¿æ¢ASRã€LLMã€TTSã€Avatarç»„ä»¶ï¼Œ
                            æ”¯æŒå¤šç§æ¨¡å‹ç»„åˆæ–¹æ¡ˆã€‚
                        </p>
                    </div>

                    <div class="feature-card">
                        <h3><span class="feature-icon">ğŸ“Š</span>å¤šå¹¶å‘</h3>
                        <p>
                            æ”¯æŒ<strong>å¤šç”¨æˆ·å¹¶å‘</strong>è®¿é—®ï¼ˆé…ç½®concurrent_liï¼‰ï¼Œ
                            LAM 3Dæ–¹æ¡ˆæ”¯æŒ5è·¯å¹¶å‘ï¼ŒLiteAvataræ”¯æŒ2-3è·¯ã€‚
                        </p>
                    </div>
                </div>
            </div>

            <!-- åº”ç”¨åœºæ™¯ -->
            <div class="section">
                <h2 class="section-title">ğŸ¬ å…¸å‹åº”ç”¨åœºæ™¯</h2>

                <h3 class="subsection-title">åœºæ™¯1ï¼šæ™ºèƒ½å®¢æœ</h3>
                <p>
                    <strong>ç”¨æˆ·ï¼š</strong>é€šè¿‡æ‘„åƒå¤´å±•ç¤ºå•†å“<br>
                    <strong>AIï¼š</strong>"æˆ‘çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªçº¢è‰²çš„æ‰‹æœºå£³ï¼Œå‹å·æ˜¯iPhone 14 Proã€‚è¯·é—®éœ€è¦å¸®æ‚¨æŸ¥è¯¢è¿™æ¬¾äº§å“çš„è¯¦ç»†ä¿¡æ¯å—ï¼Ÿ"<br>
                    <strong>ä»·å€¼ï¼š</strong>ç†è§£ç”¨æˆ·å±•ç¤ºçš„ç‰©å“ï¼Œæä¾›ç²¾å‡†æœåŠ¡
                </p>

                <h3 class="subsection-title">åœºæ™¯2ï¼šåœ¨çº¿æ•™è‚²</h3>
                <p>
                    <strong>å­¦ç”Ÿï¼š</strong>å±å¹•å…±äº«æ•°å­¦é¢˜<br>
                    <strong>AIè€å¸ˆï¼š</strong>"æˆ‘çœ‹åˆ°ä½ åœ¨ç¬¬3æ­¥å‡ºç°äº†é”™è¯¯ã€‚ä½ å°†2xå†™æˆäº†xÂ²ï¼Œåº”è¯¥æ˜¯2x+5=15ï¼Œæ‰€ä»¥x=5ï¼Œä¸æ˜¯x=10ã€‚"<br>
                    <strong>ä»·å€¼ï¼š</strong>çœ‹æ‡‚å­¦ç”Ÿå±å¹•ä¸Šçš„é¢˜ç›®ï¼ŒæŒ‡å‡ºå…·ä½“é”™è¯¯ä½ç½®
                </p>

                <h3 class="subsection-title">åœºæ™¯3ï¼šæŠ€æœ¯æ”¯æŒ</h3>
                <p>
                    <strong>ç”¨æˆ·ï¼š</strong>å±å¹•å…±äº«è½¯ä»¶æŠ¥é”™ç•Œé¢<br>
                    <strong>AIï¼š</strong>"æˆ‘çœ‹åˆ°é”™è¯¯ä»£ç 0x80070057ï¼Œè¿™æ˜¯Windowså‚æ•°é”™è¯¯ã€‚é€šå¸¸æ˜¯å› ä¸ºç³»ç»Ÿæ–‡ä»¶æŸåã€‚å»ºè®®è¿è¡Œsfc /scannowå‘½ä»¤ä¿®å¤..."<br>
                    <strong>ä»·å€¼ï¼š</strong>ç›´æ¥çœ‹åˆ°é”™è¯¯ä¿¡æ¯ï¼Œç»™å‡ºç²¾å‡†è§£å†³æ–¹æ¡ˆ
                </p>

                <h3 class="subsection-title">åœºæ™¯4ï¼šè¿œç¨‹åä½œ</h3>
                <p>
                    <strong>è®¾è®¡å¸ˆï¼š</strong>å±å¹•å…±äº«è®¾è®¡ç¨¿<br>
                    <strong>AIï¼š</strong>"è¿™ä¸ªæŒ‰é’®çš„é¢œè‰²ä¸æ•´ä½“é£æ ¼ä¸å¤ªåè°ƒï¼Œå»ºè®®ä½¿ç”¨#3498dbè“è‰²ã€‚å¦å¤–ï¼Œæ ‡é¢˜å­—å·å»ºè®®è°ƒæ•´ä¸º24pxä»¥ä¿æŒå±‚çº§æ¸…æ™°ã€‚"<br>
                    <strong>ä»·å€¼ï¼š</strong>ç†è§£è®¾è®¡å†…å®¹ï¼Œæä¾›ä¸“ä¸šå»ºè®®
                </p>
            </div>

            <!-- æ€»ç»“ -->
            <div class="section">
                <h2 class="section-title">ğŸ¯ æŠ€æœ¯æ€»ç»“</h2>

                <div class="highlight-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-left-color: #a8edea;">
                    <h3 style="color: #43e97b; margin-bottom: 15px;">æ ¸å¿ƒæŠ€æœ¯é“¾è·¯</h3>
                    <p style="font-size: 1.1em; line-height: 2;">
                        <strong>æ‘„åƒå¤´/å±å¹•</strong> â†’ <strong>WebRTC</strong> (å®æ—¶ä¼ è¾“) â†’ 
                        <strong>è§†é¢‘å¸§æå–</strong> (30fps) â†’ <strong>Base64ç¼–ç </strong> â†’ 
                        <strong>VLå¤§æ¨¡å‹</strong> (è§†è§‰ç†è§£) â†’ <strong>AIå“åº”</strong> â†’ 
                        <strong>TTSåˆæˆ</strong> â†’ <strong>æ•°å­—äººæ¸²æŸ“</strong> â†’ <strong>è¿”å›ç”¨æˆ·</strong><br><br>
                        = <strong>ğŸ‰ "çœ‹å¾—è§ã€å¬å¾—åˆ°ã€èƒ½ç†è§£"çš„æ™ºèƒ½æ•°å­—äººå¯¹è¯ç³»ç»Ÿ</strong>
                    </p>
                </div>

                <h3 class="subsection-title">å…³é”®åˆ›æ–°ç‚¹</h3>
                <ul style="margin-left: 30px; margin-top: 15px; line-height: 2;">
                    <li>âœ… <strong>å®æ—¶è§†è§‰å¯¹è¯</strong>ï¼šå°†å®æ—¶è§†é¢‘æµä¸LLMç»“åˆï¼ŒAIèƒ½"çœ‹åˆ°"ç”¨æˆ·</li>
                    <li>âœ… <strong>å±å¹•å…±äº«ç†è§£</strong>ï¼šé€šè¿‡è½¨é“æ›¿æ¢è®©AIçœ‹åˆ°ç”¨æˆ·ç”µè„‘å±å¹•</li>
                    <li>âœ… <strong>ç»Ÿä¸€æ•°æ®æµ</strong>ï¼šæ‘„åƒå¤´å’Œå±å¹•å…±äº«å¤ç”¨ç›¸åŒçš„å¤„ç†ç®¡é“</li>
                    <li>âœ… <strong>ä½å»¶è¿Ÿæ¶æ„</strong>ï¼š2.2ç§’ç«¯åˆ°ç«¯å»¶è¿Ÿï¼Œæ¥è¿‘å®æ—¶äº¤äº’</li>
                    <li>âœ… <strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šHandleræ’ä»¶æ¶æ„ï¼Œçµæ´»ç»„åˆAIæ¨¡å‹</li>
                </ul>

                <h3 class="subsection-title">æŠ€æœ¯éš¾ç‚¹çªç ´</h3>
                <ul style="margin-left: 30px; margin-top: 15px; line-height: 2;">
                    <li>ğŸ”§ <strong>WebRTCè½¨é“ç®¡ç†</strong>ï¼šreplaceTrackæ— ç¼åˆ‡æ¢è§†é¢‘æº</li>
                    <li>ğŸ”§ <strong>å›¾åƒç¼–ç ä¼˜åŒ–</strong>ï¼šJPEGå‹ç¼©+Base64ï¼Œå¹³è¡¡è´¨é‡å’Œä¼ è¾“</li>
                    <li>ğŸ”§ <strong>å¼‚æ­¥æµæ°´çº¿</strong>ï¼šVADã€ASRã€LLMã€TTSã€Avatarå¹¶å‘å¤„ç†</li>
                    <li>ğŸ”§ <strong>NATç©¿é€</strong>ï¼šSTUN/TURNæœåŠ¡å™¨ç¡®ä¿è·¨ç½‘ç»œè¿æ¥</li>
                    <li>ğŸ”§ <strong>GPUåŠ é€Ÿ</strong>ï¼šPyTorchæ¨¡å‹æ¨ç†å’Œæ•°å­—äººæ¸²æŸ“ä¼˜åŒ–</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>OpenAvatarChat - æ•°å­—äººäº¤äº’æŠ€æœ¯æ¶æ„</strong></p>
            <p>å¼€å‘è€…ï¼šå»–ä¼Ÿæ° | æ›´æ–°æ—¶é—´ï¼š2025-11-11</p>
            <p>æŠ€æœ¯æ ˆï¼šWebRTC + aiortc + Qwen-VL-Plus + Vue3 + FastAPI</p>
            <p style="margin-top: 20px; font-size: 0.9em; opacity: 0.8;">
                Â© 2025 OpenAvatarChat Project. æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ•°å­—äººäº¤äº’çš„æŠ€æœ¯æ¶æ„ä¸å®ç°åŸç†ã€‚
            </p>
        </div>
    </div>
</body>
</html>

