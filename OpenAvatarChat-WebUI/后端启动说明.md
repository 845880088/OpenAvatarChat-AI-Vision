# 🚀 OpenAvatarChat 后端启动指南

## 📋 项目架构理解

OpenAvatarChat 采用**前后端分离**架构：
- **后端**: 主项目目录 `OpenAvatarChat-250916\`
- **前端**: WebUI子目录 `OpenAvatarChat-250916\OpenAvatarChat-WebUI\`

## 🎯 后端启动方式

### ✅ 方法1: 官方一键启动脚本 (推荐)

在 **主项目目录** (`OpenAvatarChat-250916\`) 双击运行：

```
01运行程序-lam.bat              # LAM 3D数字人 (标准版)
02运行程序-liteavatar.bat       # LiteAvatar 2D数字人
03运行程序-musetalk.bat         # MuseTalk 2D数字人  
04运行程序-lam-VL.bat           # LAM 3D + 视觉理解 🆕
```

**推荐配置**:
- **体验测试**: `01运行程序-lam.bat` (标准3D数字人)
- **视觉理解**: `04运行程序-lam-VL.bat` (支持摄像头画面理解)

### ✅ 方法2: 命令行启动

在 **主项目目录** 运行：

```bash
# 使用项目虚拟环境
.glut\python.exe src\demo.py --config config\glut.yaml

# 或使用开源版本配置
.glut\python.exe src\demo.py --config config\chat_with_openai_compatible.yaml
```

### ✅ 方法3: 自定义配置

```bash
# 指定主机和端口
.glut\python.exe src\demo.py --host 127.0.0.1 --port 8282 --config config\glut.yaml

# 外网访问 (生产环境)
.glut\python.exe src\demo.py --host 0.0.0.0 --port 8282 --config config\chat_with_lam.yaml
```

## 📋 环境说明

### Python虚拟环境
- **环境路径**: `.glut\`
- **Python**: `.glut\python.exe`
- **不是Conda**: 这是一个预配置的独立Python环境
- **包含组件**: Python + PyTorch + CUDA + FFmpeg + Git

### 配置文件类型
| 配置文件 | 用途 | API Key | 适用场景 |
|----------|------|---------|----------|
| `config/glut*.yaml` | 一键启动 | 硬编码 | 体验测试 |
| `config/chat_with_*.yaml` | 生产配置 | 环境变量 | 正式部署 |

## 🌐 后端服务访问

启动成功后访问：
- **HTTPS**: `https://127.0.0.1:8282` (默认)
- **HTTP**: `http://127.0.0.1:7860` (备用)

## ⚠️ 常见问题

### Q1: "conda" 命令不存在
**原因**: 项目不使用conda，使用自带的`.glut\`环境
**解决**: 直接运行启动脚本，不需要激活conda环境

### Q2: 找不到模型文件
**原因**: 首次运行需要下载模型
**解决**: 
1. 确保网络连接正常
2. 等待模型自动下载完成
3. 或手动运行: `bash scripts/download_liteavatar_weights.sh`

### Q3: SSL证书错误
**原因**: 缺少SSL证书
**解决**: 
1. 运行: `bash scripts/create_ssl_certs.sh`
2. 或使用HTTP访问: `http://127.0.0.1:7860`

### Q4: 端口被占用
**原因**: 8282或7860端口被其他程序使用
**解决**: 
```bash
# 指定其他端口
.glut\python.exe src\demo.py --port 8888 --config config\glut.yaml
```

## 🎮 启动步骤总结

1. **打开终端** → 进入主项目目录 `OpenAvatarChat-250916\`
2. **选择启动方式**:
   - 简单: 双击 `01运行程序-lam.bat`
   - 高级: 双击 `04运行程序-lam-VL.bat`
   - 自定义: 命令行运行 `.glut\python.exe src\demo.py ...`
3. **等待启动** → 看到 "服务已启动" 提示
4. **访问界面** → `https://127.0.0.1:8282`

## 🔗 与前端集成

前端启动后会自动代理后端：
- 前端地址: `http://localhost:5173`
- 后端代理: `127.0.0.1:8282`

确保后端启动在前端之前！

---

**🎉 现在后端应该正常启动了！接下来启动前端即可开始使用屏幕共享功能！**
