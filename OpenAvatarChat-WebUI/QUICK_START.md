# 🚀 OpenAvatarChat 完整启动指南

## 📋 项目架构理解

OpenAvatarChat 采用**前后端分离**架构：

```
OpenAvatarChat-250916/               # 主项目根目录
├── 01运行程序-lam.bat                # ✅ 后端启动脚本 (LAM 3D)
├── 04运行程序-lam-VL.bat             # ✅ 后端启动脚本 (LAM + 视觉)
├── .glut/                          # ✅ Python虚拟环境 (不是conda!)
├── src/demo.py                     # ✅ 后端主程序
├── config/*.yaml                   # ✅ 后端配置文件
└── OpenAvatarChat-WebUI/           # 🆕 前端项目目录
    ├── start-dev.bat               # ✅ 前端启动脚本
    └── src/                        # Vue.js前端源码
```

## 🎯 正确启动流程

### 🥇 方法1: 双击启动 (推荐)

**第1步: 启动后端** (在主项目目录)
```
双击: 01运行程序-lam.bat           # LAM 3D数字人
或者: 04运行程序-lam-VL.bat        # LAM + 视觉理解 (推荐)
```

**第2步: 启动前端** (在WebUI目录)  
```
双击: OpenAvatarChat-WebUI\start-dev.bat
```

### 🥈 方法2: 命令行启动

**后端启动**:
```bash
# 在主项目目录 OpenAvatarChat-250916\
.glut\python.exe src\demo.py --config config\glut-VL.yaml
```

**前端启动**:
```bash
# 在前端目录 OpenAvatarChat-WebUI\
.\start-dev.bat
```

## 📋 启动检查清单

### 🔍 环境检查
- [ ] ✅ 在正确目录: `OpenAvatarChat-WebUI\`
- [ ] ✅ 主项目存在: `../src/demo.py` 和 `../.glut/`
- [ ] ✅ Node.js 已安装 (推荐 18.x+)
- [ ] ✅ 后端服务已启动 (端口8282)

### 🚨 常见错误修复

#### ❌ 错误1: 目录不正确
```
❌ 错误：请在 OpenAvatarChat-WebUI 目录中运行此脚本
当前目录: E:\某个错误路径
正确目录: OpenAvatarChat-250916\OpenAvatarChat-WebUI\
```
**解决**: 确保在 `OpenAvatarChat-WebUI` 目录内运行 `start-dev.bat`

#### ❌ 错误2: 主项目缺失
```
❌ 错误：未找到主项目
请确保此目录在 OpenAvatarChat-250916 主项目内
```
**解决**: 确保目录结构正确，`OpenAvatarChat-WebUI` 应该在主项目内

#### ❌ 错误3: conda环境错误  
```
conda : 无法将"conda"项识别为 cmdlet、函数、脚本文件...
```
**解决**: 项目**不使用conda**！直接双击官方启动脚本即可

#### ✅ Node.js和包管理器
```
⚠️ pnpm 未安装，使用 npm
✅ 使用 npm x.x.x
```
**说明**: 自动回退到 npm，这是正常的

## 🌟 功能验证

### 1. 前端功能检查
访问 `http://localhost:5173`，确认：
- [ ] 页面正常加载
- [ ] 摄像头权限获取成功
- [ ] "点击开始对话" 按钮可用

### 2. 屏幕共享功能检查
- [ ] ActionGroup 中有屏幕共享按钮 📱
- [ ] 点击后浏览器弹出共享选择框
- [ ] 右上角显示信息面板
- [ ] 设置面板可展开/收起
- [ ] 统计面板显示连接信息

### 3. TURN连接检查
在统计面板中确认：
- [ ] TURN服务器: 8.138.87.249:3478
- [ ] 连接状态: 已连接 (绿点)
- [ ] 质量指示: 良好/优秀

## 🎨 界面预览

### 屏幕共享信息面板
```
┌─────────────────────────────┐
│ 🟢 已连接到TURN服务器 [良好] │
│                    ⚙️📊❌ │
├─────────────────────────────┤
│ 🎚️ 质量设置                │
│ ● 移动优化 ● 桌面标准 ○ 高质量│
│                             │
│ 📹 捕获设置                 │
│ [🪟 应用程序窗口     ▼]     │
│ 🔊 包含系统音频      ○      │
│ 🔄 自动质量调整      ●      │
└─────────────────────────────┘
```

### 统计面板
```
┌─────────────────────────────┐
│ 📊 性能统计                 │
├─────────────────────────────┤
│ 📊 1.2MB/s  ⏱️ 45ms       │  
│ 📦 0 丢包    🔗 TURN       │
├─────────────────────────────┤
│ 🌐 TURN服务器: 8.138.87.249 │
│ 🖥️ 服务器配置: 2vCPU/4GiB   │
│ 📍 视频源: 屏幕共享          │
└─────────────────────────────┘
```

## 🚨 常见问题解决

### Q1: 前端启动后无法访问
**现象**: 访问 http://localhost:5173 显示无法连接
**解决**: 
1. 检查防火墙是否阻止端口 5173
2. 尝试使用 http://127.0.0.1:5173
3. 查看启动日志是否有错误

### Q2: 屏幕共享按钮无反应
**现象**: 点击屏幕共享按钮没有弹出选择框
**解决**:
1. 确保使用 HTTPS 或 localhost
2. 检查浏览器是否支持 getDisplayMedia
3. 查看浏览器控制台错误信息

### Q3: TURN连接失败
**现象**: 连接状态显示"连接失败"或"断开"
**解决**:
1. 检查网络防火墙设置
2. 确认 8.138.87.249:3478 端口可访问
3. 重启后端服务

### Q4: 中文显示乱码
**现象**: 启动脚本中文显示为问号或方块
**解决**: ✅ 已修复，脚本已添加 UTF-8 编码设置

## 📞 获取帮助

### 日志查看
- **前端日志**: 浏览器开发者工具 Console
- **后端日志**: 后端启动窗口输出
- **WebRTC日志**: 浏览器地址栏输入 `chrome://webrtc-internals/`

### 问题报告
如遇到问题，请提供：
1. 操作系统版本
2. Node.js 版本 (`node --version`)
3. 浏览器版本
4. 错误截图或日志内容

---

**🎉 现在开始享受现代化的屏幕共享功能吧！**

> 基于云服务器TURN架构，为你提供稳定可靠的跨网络屏幕共享体验！
